{% extends 'marketplace/base.html' %}
{% load static %}
{% load string_filters %}   <!-- Changed from split_filters -->

{% block title %}Payment Guidance - Subscription{% endblock %}


{% block content %}
<div class="container py-4">
  <h2 class="mb-4">Payment Guidance</h2>



  <!-- Mobile Payment Networks -->
  <div class="row g-4 mb-4">
    {% for network in networks %}
      <div class="col-6 col-md-3 text-center">
        <div class="card h-100 shadow-sm border-0">
          <div class="card-body d-flex flex-column align-items-center justify-content-center">
            {% if network.image %}
              <img src="{{ network.image.url }}" class="img-fluid mb-2" style="max-height:80px; object-fit:contain;">
            {% else %}
              <div class="img-fluid mb-2" style="max-height:80px; object-fit:contain; background:#eee; width:100%; height:80px; display:flex; align-items:center; justify-content:center;">
                <span class="text-muted small">No image</span>
              </div>
            {% endif %}
            <div class="fw-bold">{{ network.name }}</div>
            {% for namba in network.lipa_numbers.all %}
              <div class="lipa-number-box mt-2 mb-2">
                <span class="lipa-number">{{ namba.number }}</span>
              </div>
            {% empty %}
              <div class="text-muted small">No numbers added</div>
            {% endfor %}
          </div>
        </div>
      </div>
    {% empty %}
      <p>No mobile networks configured.</p>
    {% endfor %}

  <!-- Payment Instructions -->
  <div class="alert alert-info mb-4">
    <h5 class="mb-2">How to Pay via Lipa Number</h5>
    <ul class="mb-2">
      <li><b>M-Pesa (Vodacom):</b>
        <ol class="mb-1">
          <li>Dial <b>*150*00#</b></li>
          <li>Select <b>4: Pay by M-Pesa</b></li>
          <li>Select <b>1: Pay by phone</b></li>
          <li>Select <b>1: Enter Lipa Number</b></li>
          <li>Enter the Lipa Number shown above</li>
          <li>Enter the amount and your PIN to confirm</li>
        </ol>
      </li>
      <li><b>Airtel Money:</b>
        <ol class="mb-1">
          <li>Dial <b>*150*60#</b></li>
          <li>Select <b>Pay Bills</b> or <b>Make Payment</b></li>
          <li>Choose <b>Merchant Payment</b> or <b>Lipa Number</b></li>
          <li>Enter the Lipa Number shown above</li>
          <li>Enter the amount and your PIN to confirm</li>
        </ol>
      </li>
      <li><b>HaloPesa:</b>
        <ol class="mb-1">
          <li>Dial <b>*150*88#</b> or use the HaloPesa app</li>
          <li>Select <b>Pay Merchant</b> or <b>Lipa Number</b></li>
          <li>Enter the Lipa Number shown above</li>
          <li>Enter the amount and your PIN to confirm</li>
        </ol>
      </li>
      <li><b>Mixx by Yas:</b>
        <ol class="mb-1">
          <li>Open the Mixx app or dial the USSD code (e.g., <b>*150*28#</b>)</li>
          <li>Select <b>Lipa kwa Simu</b> or <b>Pay Merchant</b></li>
          <li>Enter the Lipa Number shown above</li>
          <li>Enter the amount and your PIN to confirm</li>
        </ol>
      </li>
    </ul>
    <div class="small text-muted">For all networks, use the Lipa Number displayed above for your chosen network. If you need help, contact your provider's customer care.</div>
  </div>


</div>
<style>
  .lipa-number-box {
    background: #fffbe6;
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 8px 0;
    margin: 0 auto;
    width: 90%;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 8px rgba(255,193,7,0.08);
  }
  .lipa-number {
    font-family: 'Roboto Mono', 'Consolas', 'Menlo', monospace, Arial, sans-serif;
    font-size: 1.5rem;
    font-weight: bold;
    color: #d35400;
    letter-spacing: 2px;
    text-shadow: 0 1px 2px #fff3cd;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  // Toggle benefits for selected tier
  document.querySelectorAll('input[name="tier"]').forEach(function(radio) {
    radio.addEventListener('change', function() {
      document.querySelectorAll('.tier-benefits').forEach(function(div) {
        div.classList.add('d-none');
      });
      var id = this.id.replace('tier', '');
      var selected = document.getElementById('benefits-' + id);
      if(selected) selected.classList.remove('d-none');
    });
  });
</script>
{% endblock %}